<html>
<head>
    <meta http-equiv="Content-type" content="text/html; charset=UTF-8">
    <title>logs</title>
    <script src="/static/admin/js/jquery-1.4.3.min.js"></script>
    <!--load layui-->
    <script src="/static/public/layui.js"></script>
    <link href="/static/public/css/layui.css" rel="stylesheet"/>
    <style type="text/css">
        .layui-btn .layui-icon {
            margin-right: 0;
        }
    </style>
</head>

<body>
<table class="layui-table" lay-skin="line">
    <thead>
    <colgroup>
        <col width="80">
        <col width="200">
        <col width="100">
        <col width="100">
        <col>
        <col width="100">
    </colgroup>
    <tr style="background:#eee">
        <th>序号</th>
        <th>日期</th>
        <th>用户</th>
        <th>操作</th>
        <th>日志</th>
        <th>操作</th>
    </tr>
    </thead>
    <tbody id="list">
    {% for i in log_data %}
    <tr>
        <td>{{forloop.counter}}</td>
        <td>{{i.action_time}}</td>
        <td>
            {% for u in all_user %}
            {% if u.id == i.user_id %}{{u.first_name}}{% endif %}
            {% endfor %}
        </td>
        <td>
            {% for a in action_flag %}
            {% if a.1 == i.action_flag %}{{a.0}}{% endif %}
            {% endfor %}
        </td>
        <td>{{i.object_repr}}</td>
        <td><a title="rollback" flag="{{i.id}}" class="layui-btn layui-btn-primary layui-btn-xs btn-rollback">
            <i class="layui-icon layui-icon-refresh"></i>
        </a>
        </td>
    </tr>
    {% endfor %}
    </tbody>
</table>
<script type="text/javascript">
    layui.use('layer', function () {
        $('.btn-rollback').bind('click', function () {
            var id = $(this).attr('flag')
            layer.confirm('确定要回滚该记录吗', function (index) {
                layer.close(index)
                let url = "/admin/log-rollback/" + id
                $.getJSON(
                    url,
                    function (d) {
                        layer.alert(d.msg);
                        if (d.code == 0){
                            window.location.href = d.jumpurl;
                        }
                    });
            });
        });
    })
</script>
</body>
</html>